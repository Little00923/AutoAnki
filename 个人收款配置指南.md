# 💰 个人收款配置指南（简化版）

## 适用场景

✅ 个人开发者  
✅ 小规模应用  
✅ 不需要自动到账  
✅ 手动确认充值  

---

## 🚀 快速配置（3步完成）

### 步骤1：准备收款码

#### 微信收款码
1. 打开微信
2. 点击右上角 `+` → `收付款` → `二维码收款`
3. 点击`保存收款码`
4. 将图片重命名为 `wechat-qr.png`

#### 支付宝收款码
1. 打开支付宝
2. 首页点击`收钱`
3. 点击`保存图片`
4. 将图片重命名为 `alipay-qr.png`

---

### 步骤2：上传收款码

将收款码图片放到项目的 `public/payment/` 目录：

```bash
mkdir -p public/payment
```

然后将您的收款码图片复制到这个目录：
```
public/payment/
├── wechat-qr.png   # 微信收款码
└── alipay-qr.png   # 支付宝收款码
```

---

### 步骤3：修改充值页面

我已经为您准备了简化的充值页面配置。

---

## 📱 充值流程

### 用户端流程
1. 用户点击"充值"
2. 选择充值金额（10元、50元、100元等）
3. 选择支付方式（微信/支付宝）
4. 显示您的收款码
5. 用户扫码支付
6. 用户截图支付成功页面
7. 用户点击"已完成支付"
8. 系统记录充值申请

### 管理员端流程
1. 查看充值申请列表
2. 核对支付截图/转账记录
3. 手动给用户充值积分
4. 标记订单为已完成

---

## 🛠️ 管理员充值积分

### 方法1：使用数据库管理工具（推荐）

```bash
./db_manager.sh

# 选择 3) 给用户充值积分
# 输入用户名：L
# 输入充值积分：1000
# 输入说明：充值10元
```

### 方法2：使用 SQL 命令

```bash
sqlite3 database/autoanki.db << 'EOF'
BEGIN TRANSACTION;

-- 给用户充值 1000 积分（10元 = 1000积分）
UPDATE users 
SET credits = credits + 1000 
WHERE username = 'L';

-- 记录交易
INSERT INTO credit_transactions (user_id, amount, type, description, balance_after)
SELECT id, 1000, 'recharge', '充值10元（手动）', credits
FROM users 
WHERE username = 'L';

COMMIT;
EOF
```

### 方法3：使用充值脚本

创建快速充值脚本：
```bash
cat > recharge.sh << 'SCRIPT'
#!/bin/bash
echo "=== 快速充值工具 ==="
read -p "用户名: " username
read -p "充值金额（元）: " amount
credits=$((amount * 100))

sqlite3 database/autoanki.db << EOF
BEGIN TRANSACTION;
UPDATE users SET credits = credits + $credits WHERE username = '$username';
INSERT INTO credit_transactions (user_id, amount, type, description, balance_after)
SELECT id, $credits, 'recharge', '充值${amount}元（手动）', credits
FROM users WHERE username = '$username';
COMMIT;
EOF

echo "✓ 已为 $username 充值 $credits 积分（$amount 元）"
SCRIPT

chmod +x recharge.sh
```

使用：
```bash
./recharge.sh
```

---

## 📊 充值申请管理

### 查看待处理充值申请

```bash
sqlite3 -column -header database/autoanki.db << 'EOF'
SELECT 
    o.id,
    u.username as '用户',
    o.amount as '金额',
    o.credits as '积分',
    o.payment_method as '方式',
    o.status as '状态',
    datetime(o.created_at, 'localtime') as '申请时间'
FROM orders o
JOIN users u ON o.user_id = u.id
WHERE o.status = 'pending'
ORDER BY o.created_at DESC;
EOF
```

### 标记订单已完成

```bash
sqlite3 database/autoanki.db << 'EOF'
-- 更新订单状态
UPDATE orders 
SET status = 'paid', 
    paid_at = CURRENT_TIMESTAMP 
WHERE order_no = '订单号';
EOF
```

---

## 🎯 充值金额对照表

| 充值金额 | 获得积分 | 可生成卡片 |
|---------|---------|-----------|
| 10元    | 1000积分 | 66张      |
| 50元    | 5000积分 | 333张     |
| 100元   | 10000积分| 666张     |
| 200元   | 20000积分| 1333张    |

*按照 15积分/张 计算*

---

## 📝 充值记录模板

建议使用表格记录充值：

| 日期 | 用户名 | 充值金额 | 支付方式 | 转账时间 | 已处理 |
|-----|--------|---------|---------|---------|--------|
| 2025-10-16 | user1 | 10元 | 微信 | 14:30 | ✓ |
| 2025-10-16 | user2 | 50元 | 支付宝 | 15:20 | ✓ |

或使用 Excel/Google Sheets 管理。

---

## 🔔 充值通知

### 方式1：邮件通知
用户充值申请后，发送邮件通知管理员。

### 方式2：定期检查
每天固定时间（如早上9点、下午3点）检查充值申请：
```bash
# 添加到 crontab
0 9,15 * * * cd /home/ling/coding/newAutoAnki && ./check_orders.sh
```

### 方式3：即时通知
使用 Webhook 发送到微信/钉钉群。

---

## 💡 优化建议

### 1. 添加充值说明
在充值页面添加：
- "请在支付备注中填写您的用户名"
- "支付完成后请保留截图"
- "积分将在 1-24 小时内到账"

### 2. 自动识别（可选）
如果转账较多，可以要求用户在支付备注中填写：
- 用户名
- 订单号

这样可以快速匹配充值记录。

### 3. 设置自动提醒
创建检查脚本 `check_orders.sh`：
```bash
#!/bin/bash
COUNT=$(sqlite3 database/autoanki.db "SELECT COUNT(*) FROM orders WHERE status='pending'")
if [ $COUNT -gt 0 ]; then
    echo "⚠️ 有 $COUNT 个待处理充值申请"
    # 可以发送通知到邮箱或微信
fi
```

---

## 🔒 安全建议

### 1. 定期更换收款码
每个月更换一次收款码，防止被盗用。

### 2. 收款码水印
在收款码上添加应用名称水印：
```
AutoAnki 专用收款码
仅限本应用充值使用
```

### 3. 金额限制
```javascript
// 前端限制充值金额
const allowedAmounts = [10, 50, 100, 200, 500];
```

### 4. 记录保存
保留所有支付截图，建议保存 3 个月以上。

---

## 📂 文件组织

```
public/payment/
├── wechat-qr.png      # 微信收款码
├── alipay-qr.png      # 支付宝收款码
└── README.txt         # 说明文件

scripts/
├── recharge.sh        # 快速充值脚本
└── check_orders.sh    # 检查待处理订单
```

---

## 🎨 收款码美化（可选）

### 添加应用信息
在收款码图片上添加：
- 应用名称："AutoAnki"
- 提示文字："请在备注中填写用户名"
- 客服联系方式

### 工具推荐
- **创客贴**：在线设计
- **Canva**：模板丰富
- **PS/AI**：专业设计

### 示例文案
```
┌─────────────────┐
│   AutoAnki 充值   │
│                 │
│   [收款二维码]    │
│                 │
│ 请在备注填写用户名 │
│ 积分1-24小时到账  │
└─────────────────┘
```

---

## ⚠️ 注意事项

### 1. 不要使用商家收款码
- ❌ 商家收款码可能被封号
- ✅ 使用个人收款码
- ✅ 分散风险（准备多个账号）

### 2. 金额不要过大
- 建议单笔充值不超过 500 元
- 大额充值分多次处理

### 3. 留存证据
- 保存所有支付截图
- 记录充值时间和金额
- 定期备份数据库

### 4. 及时处理
- 尽量在 24 小时内处理充值
- 避免用户等待过久

---

## 📱 用户充值教程

创建 `public/recharge-guide.html` 充值说明页面：

```html
<h2>充值教程</h2>
<ol>
  <li>选择充值金额</li>
  <li>选择支付方式（微信/支付宝）</li>
  <li>扫描收款码完成支付</li>
  <li>在支付备注中填写您的用户名</li>
  <li>保存支付成功截图</li>
  <li>点击"已完成支付"</li>
  <li>等待积分到账（1-24小时）</li>
</ol>

<h3>注意事项</h3>
<ul>
  <li>务必在备注中填写用户名</li>
  <li>保留支付截图以便查询</li>
  <li>如24小时未到账请联系客服</li>
</ul>
```

---

## 🆚 个人收款 vs 商户接口

| 对比项 | 个人收款码 | 商户接口 |
|-------|----------|---------|
| 费用 | 免费 | 需要手续费（0.6%） |
| 开通难度 | 简单（立即使用） | 复杂（需要营业执照） |
| 到账方式 | 手动充值 | 自动到账 |
| 处理时效 | 1-24小时 | 实时 |
| 适用规模 | 小规模（<100人） | 大规模 |
| 维护成本 | 低 | 高 |

---

## 🚀 快速开始

### 1. 上传收款码
```bash
mkdir -p public/payment
# 将您的收款码复制到 public/payment/ 目录
```

### 2. 创建充值脚本
```bash
cat > recharge.sh << 'SCRIPT'
#!/bin/bash
read -p "用户名: " username
read -p "金额（元）: " amount
credits=$((amount * 100))
sqlite3 database/autoanki.db << EOF
BEGIN;
UPDATE users SET credits = credits + $credits WHERE username = '$username';
INSERT INTO credit_transactions (user_id, amount, type, description, balance_after)
SELECT id, $credits, 'recharge', '充值${amount}元', credits FROM users WHERE username = '$username';
COMMIT;
EOF
echo "✓ 充值完成：$username +$credits积分"
SCRIPT
chmod +x recharge.sh
```

### 3. 测试充值
```bash
./recharge.sh
# 输入用户名: L
# 输入金额: 10
```

---

## ✅ 优势

- ✅ **零成本**：无需支付手续费
- ✅ **即开即用**：5分钟完成配置
- ✅ **安全可靠**：直接收到自己账户
- ✅ **灵活控制**：手动审核每笔充值
- ✅ **无需资质**：个人即可使用

---

**个人收款方案已准备完成！** 🎉

只需上传收款码图片，即可开始收款。用户支付后，您手动充值积分即可。


