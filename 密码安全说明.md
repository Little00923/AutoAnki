# ğŸ” å¯†ç å­˜å‚¨ä¸å®‰å…¨è¯´æ˜

## ğŸ“‹ å¿«é€Ÿå›ç­”

### å¯†ç å¦‚ä½•å­˜å‚¨ï¼Ÿ

âœ… **ä½¿ç”¨ bcrypt åŠ å¯†ç®—æ³•å­˜å‚¨**
- **ä¸å­˜å‚¨æ˜æ–‡å¯†ç **
- **å•å‘å“ˆå¸ŒåŠ å¯†ï¼Œä¸å¯é€†**
- **åŠ ç›ï¼ˆsaltï¼‰å¤„ç†ï¼Œæ¯ä¸ªå¯†ç çš„å“ˆå¸Œéƒ½æ˜¯å”¯ä¸€çš„**
- **ç¬¦åˆä¸šç•Œå®‰å…¨æ ‡å‡†**

---

## ğŸ”’ è¯¦ç»†è¯´æ˜

### 1. åŠ å¯†ç®—æ³•ï¼šbcrypt

**bcrypt** æ˜¯ç›®å‰æœ€å®‰å…¨çš„å¯†ç å“ˆå¸Œç®—æ³•ä¹‹ä¸€ï¼Œç‰¹ç‚¹ï¼š

- âœ… **å•å‘åŠ å¯†**ï¼šæ— æ³•ä»å“ˆå¸Œåæ¨å‡ºåŸå§‹å¯†ç 
- âœ… **è‡ªåŠ¨åŠ ç›**ï¼šæ¯æ¬¡åŠ å¯†åŒä¸€å¯†ç äº§ç”Ÿä¸åŒå“ˆå¸Œ
- âœ… **è®¡ç®—ç¼“æ…¢**ï¼šé˜²æ­¢æš´åŠ›ç ´è§£ï¼ˆcost factor = 10ï¼‰
- âœ… **æŠ—å½©è™¹è¡¨æ”»å‡»**ï¼šå› ä¸ºæ¯ä¸ªå¯†ç éƒ½æœ‰å”¯ä¸€çš„ç›å€¼

### 2. å­˜å‚¨ä½ç½®

**æ•°æ®åº“è¡¨**ï¼š`users`  
**å­—æ®µå**ï¼š`password`  
**å­˜å‚¨å†…å®¹**ï¼š60å­—ç¬¦çš„ bcrypt å“ˆå¸Œå€¼

### 3. å®é™…å­˜å‚¨ç¤ºä¾‹

```
åŸå§‹å¯†ç :     "mypassword123"
å­˜å‚¨çš„å“ˆå¸Œ:   "$2a$10$DSLJduSdS2o9Wv0pFucMmuZ4XqKz5vN2WCyJ8BzR3qQ..."
é•¿åº¦:         60 å­—ç¬¦
```

**å“ˆå¸Œç»“æ„è§£æ**ï¼š
```
$2a$10$DSLJduSdS2o9Wv0pFucMmuZ4XqKz5vN2WCyJ8BzR3qQ...
 â”‚   â”‚  â”‚                                          â”‚
 â”‚   â”‚  â””â”€ Salt (22å­—ç¬¦)                          â””â”€ Hash (31å­—ç¬¦)
 â”‚   â””â”€ Cost Factor (10 = 2^10 æ¬¡è¿­ä»£)
 â””â”€ bcrypt ç‰ˆæœ¬ (2a)
```

---

## ğŸ’» ä»£ç å®ç°

### æ³¨å†Œæ—¶ï¼šåŠ å¯†å¯†ç 

```javascript
// æ–‡ä»¶ï¼šdatabase/db.js (156è¡Œ)
const bcrypt = require('bcryptjs');

create: async (username, email, password) => {
    // ä½¿ç”¨ bcrypt åŠ å¯†ï¼Œcost factor = 10
    const hashedPassword = bcrypt.hashSync(password, 10);
    
    // å­˜å‚¨å“ˆå¸Œå€¼ï¼Œè€Œä¸æ˜¯æ˜æ–‡
    const result = await dbRun(`
        INSERT INTO users (username, email, password) 
        VALUES (?, ?, ?)
    `, [username, email, hashedPassword]);
    
    return result.lastID;
}
```

### ç™»å½•æ—¶ï¼šéªŒè¯å¯†ç 

```javascript
// æ–‡ä»¶ï¼šdatabase/db.js (180è¡Œ)
verifyPassword: (password, hash) => {
    // æ¯”è¾ƒç”¨æˆ·è¾“å…¥çš„å¯†ç å’Œæ•°æ®åº“ä¸­çš„å“ˆå¸Œ
    return bcrypt.compareSync(password, hash);
}
```

---

## ğŸ›¡ï¸ å®‰å…¨æ€§åˆ†æ

### âœ… ä¼˜ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|-----|------|
| **ä¸å¯é€†** | å³ä½¿æ•°æ®åº“æ³„éœ²ï¼Œä¹Ÿæ— æ³•è·å¾—åŸå§‹å¯†ç  |
| **å”¯ä¸€æ€§** | å³ä½¿ä¸¤ä¸ªç”¨æˆ·å¯†ç ç›¸åŒï¼Œå­˜å‚¨çš„å“ˆå¸Œä¹Ÿä¸åŒ |
| **é˜²æš´åŠ›ç ´è§£** | è®¡ç®—ç¼“æ…¢ï¼ˆæ¯ä¸ªå¯†ç çº¦éœ€ 0.1 ç§’éªŒè¯ï¼‰ |
| **è¡Œä¸šæ ‡å‡†** | è¢«å¹¿æ³›ä½¿ç”¨ï¼ˆGitHub, Reddit ç­‰ï¼‰ |
| **è‡ªåŠ¨åŠ ç›** | ä¸éœ€è¦å•ç‹¬å­˜å‚¨ salt |

### ğŸ” å®‰å…¨ç­‰çº§

- **å½“å‰ Cost Factor**: 10ï¼ˆ2^10 = 1024 æ¬¡è¿­ä»£ï¼‰
- **æš´åŠ›ç ´è§£æ—¶é—´**ï¼šå‡è®¾æ¯ç§’å°è¯• 1000 ä¸ªå¯†ç 
  - 8ä½æ•°å­—å¯†ç ï¼šçº¦ 3 å°æ—¶
  - 8ä½å­—æ¯+æ•°å­—ï¼šçº¦ 200 å¹´
  - 10ä½æ··åˆå¯†ç ï¼šçº¦ 10ä¸‡å¹´

---

## ğŸ”¬ éªŒè¯å¯†ç å®‰å…¨æ€§

### æŸ¥çœ‹å®é™…å­˜å‚¨çš„å¯†ç å“ˆå¸Œ

```bash
sqlite3 -column -header database/autoanki.db << 'EOF'
SELECT 
    username,
    substr(password, 1, 7) as 'å“ˆå¸Œæ ‡è¯†',
    length(password) as 'é•¿åº¦',
    '*** å·²åŠ å¯† ***' as 'çŠ¶æ€'
FROM users;
EOF
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
username  å“ˆå¸Œæ ‡è¯†    é•¿åº¦  çŠ¶æ€
--------  -------  --  ----------
L         $2a$10$  60  *** å·²åŠ å¯† ***
```

### æµ‹è¯•å¯†ç éªŒè¯

```javascript
// æµ‹è¯•ä»£ç ï¼ˆä»…ç”¨äºç†è§£ï¼Œä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œï¼‰
const bcrypt = require('bcryptjs');

// åŸå§‹å¯†ç 
const password = "mypassword123";

// ç¬¬ä¸€æ¬¡åŠ å¯†
const hash1 = bcrypt.hashSync(password, 10);
console.log("ç¬¬ä¸€æ¬¡:", hash1);

// ç¬¬äºŒæ¬¡åŠ å¯†åŒä¸€å¯†ç 
const hash2 = bcrypt.hashSync(password, 10);
console.log("ç¬¬äºŒæ¬¡:", hash2);

// éªŒè¯ï¼šhash1 å’Œ hash2 ä¸åŒï¼Œä½†éƒ½èƒ½éªŒè¯æˆåŠŸ
console.log("éªŒè¯1:", bcrypt.compareSync(password, hash1)); // true
console.log("éªŒè¯2:", bcrypt.compareSync(password, hash2)); // true
console.log("é”™è¯¯å¯†ç :", bcrypt.compareSync("wrongpass", hash1)); // false
```

---

## ğŸ”§ å¯†ç ç®¡ç†æ“ä½œ

### 1. æŸ¥çœ‹ç”¨æˆ·å¯†ç çŠ¶æ€

```bash
./db_manager.sh
# é€‰æ‹© 2) æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…
# å¯†ç å­—æ®µä¸ä¼šæ˜¾ç¤ºï¼ˆå®‰å…¨è®¾è®¡ï¼‰
```

### 2. é‡ç½®ç”¨æˆ·å¯†ç 

#### æ–¹æ³•Aï¼šä½¿ç”¨è„šæœ¬

```bash
# åˆ›å»ºå¯†ç é‡ç½®è„šæœ¬
cat > reset_password.sh << 'SCRIPT'
#!/bin/bash
read -p "è¯·è¾“å…¥ç”¨æˆ·å: " username
read -s -p "è¯·è¾“å…¥æ–°å¯†ç : " password
echo

node << EOF
const bcrypt = require('bcryptjs');
const sqlite3 = require('sqlite3').verbose();

const db = new sqlite3.Database('database/autoanki.db');
const hashedPassword = bcrypt.hashSync('$password', 10);

db.run(
    'UPDATE users SET password = ?, updated_at = CURRENT_TIMESTAMP WHERE username = ?',
    [hashedPassword, '$username'],
    (err) => {
        if (err) {
            console.error('é”™è¯¯:', err);
        } else {
            console.log('âœ“ å¯†ç å·²é‡ç½®');
        }
        db.close();
    }
);
EOF
SCRIPT

chmod +x reset_password.sh
./reset_password.sh
```

#### æ–¹æ³•Bï¼šé€šè¿‡ Node.js è„šæœ¬

```bash
# åˆ›å»º reset_password.js
cat > reset_password.js << 'EOF'
const bcrypt = require('bcryptjs');
const sqlite3 = require('sqlite3').verbose();
const readline = require('readline');

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

rl.question('è¯·è¾“å…¥ç”¨æˆ·å: ', (username) => {
    rl.question('è¯·è¾“å…¥æ–°å¯†ç : ', (password) => {
        const db = new sqlite3.Database('database/autoanki.db');
        const hashedPassword = bcrypt.hashSync(password, 10);
        
        db.run(
            'UPDATE users SET password = ?, updated_at = CURRENT_TIMESTAMP WHERE username = ?',
            [hashedPassword, username],
            function(err) {
                if (err) {
                    console.error('âŒ é”™è¯¯:', err.message);
                } else if (this.changes === 0) {
                    console.log('âŒ ç”¨æˆ·ä¸å­˜åœ¨');
                } else {
                    console.log('âœ… å¯†ç å·²é‡ç½®');
                }
                db.close();
                rl.close();
            }
        );
    });
});
EOF

node reset_password.js
```

---

## ğŸš¨ å®‰å…¨å»ºè®®

### å¯¹ç”¨æˆ·çš„å»ºè®®

1. **å¯†ç å¤æ‚åº¦è¦æ±‚**
   - æœ€å°‘ 8 ä¸ªå­—ç¬¦
   - åŒ…å«å¤§å°å†™å­—æ¯
   - åŒ…å«æ•°å­—
   - åŒ…å«ç‰¹æ®Šå­—ç¬¦

2. **ä¸è¦ä½¿ç”¨çš„å¯†ç **
   - âŒ ç”Ÿæ—¥ã€ç”µè¯å·ç 
   - âŒ å¸¸è§å•è¯ï¼ˆpassword, 123456ï¼‰
   - âŒ ä¸ç”¨æˆ·åç›¸åŒ

3. **å¯†ç ç®¡ç†**
   - âœ… ä½¿ç”¨å¯†ç ç®¡ç†å™¨
   - âœ… ä¸åŒç½‘ç«™ä½¿ç”¨ä¸åŒå¯†ç 
   - âœ… å®šæœŸæ›´æ¢å¯†ç 

### å¯¹å¼€å‘è€…çš„å»ºè®®

1. **å½“å‰é…ç½®å·²ç»å¾ˆå®‰å…¨**
   - âœ… bcrypt ç®—æ³•
   - âœ… cost factor = 10
   - âœ… è‡ªåŠ¨åŠ ç›

2. **å¯ä»¥è¿›ä¸€æ­¥å¢å¼º**ï¼ˆå¯é€‰ï¼‰
   ```javascript
   // å¢åŠ  cost factor åˆ° 12ï¼ˆæ›´å®‰å…¨ä½†æ›´æ…¢ï¼‰
   const hashedPassword = bcrypt.hashSync(password, 12);
   
   // æ·»åŠ å¯†ç å¤æ‚åº¦éªŒè¯
   function validatePassword(password) {
       return password.length >= 8 &&
              /[a-z]/.test(password) &&
              /[A-Z]/.test(password) &&
              /[0-9]/.test(password);
   }
   ```

3. **å®æ–½å¯†ç ç­–ç•¥**
   - æ·»åŠ å¯†ç å¼ºåº¦æ£€æŸ¥
   - è®°å½•å¯†ç ä¿®æ”¹å†å²
   - å¼ºåˆ¶å®šæœŸæ›´æ¢å¯†ç 
   - å®æ–½è´¦å·é”å®šæœºåˆ¶ï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰

---

## ğŸ“Š æ•°æ®åº“å®‰å…¨æ£€æŸ¥

### æ£€æŸ¥æ¸…å•

```bash
# 1. ç¡®è®¤å¯†ç å·²åŠ å¯†ï¼ˆæ‰€æœ‰å¯†ç éƒ½åº”ä»¥ $2a$10$ å¼€å¤´ï¼‰
sqlite3 database/autoanki.db "
SELECT username, 
       substr(password, 1, 7) as prefix,
       CASE 
           WHEN password LIKE '\$2a\$10\$%' THEN 'âœ“ å·²åŠ å¯†'
           ELSE 'âœ— å¼‚å¸¸'
       END as status
FROM users;
"

# 2. ç¡®è®¤æ²¡æœ‰æ˜æ–‡å¯†ç 
sqlite3 database/autoanki.db "
SELECT COUNT(*) as risky_count
FROM users 
WHERE length(password) < 50;
"
# åº”è¯¥è¿”å› 0

# 3. æ£€æŸ¥å¯†ç å“ˆå¸Œé•¿åº¦
sqlite3 database/autoanki.db "
SELECT username,
       length(password) as hash_length,
       CASE 
           WHEN length(password) = 60 THEN 'âœ“ æ­£å¸¸'
           ELSE 'âœ— å¼‚å¸¸'
       END as status
FROM users;
"
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: ç®¡ç†å‘˜èƒ½çœ‹åˆ°ç”¨æˆ·çš„å¯†ç å—ï¼Ÿ
**A**: âŒ **ä¸èƒ½ï¼** å¯†ç æ˜¯å•å‘åŠ å¯†çš„ï¼Œå³ä½¿æ˜¯ç®¡ç†å‘˜ä¹Ÿæ— æ³•è·å–åŸå§‹å¯†ç ã€‚åªèƒ½é‡ç½®å¯†ç ã€‚

### Q2: å¦‚æœå¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ
**A**: åªèƒ½é€šè¿‡ç®¡ç†å‘˜é‡ç½®å¯†ç ï¼Œæˆ–è€…å®ç°"å¿˜è®°å¯†ç "åŠŸèƒ½ï¼ˆå‘é€é‡ç½®é‚®ä»¶ï¼‰ã€‚

### Q3: æ•°æ®åº“æ³„éœ²äº†æ€ä¹ˆåŠï¼Ÿ
**A**: bcrypt åŠ å¯†ä½¿å¾—ç ´è§£éå¸¸å›°éš¾ï¼Œä½†ä»ç„¶å»ºè®®ï¼š
1. ç«‹å³é€šçŸ¥æ‰€æœ‰ç”¨æˆ·
2. å¼ºåˆ¶é‡ç½®æ‰€æœ‰å¯†ç 
3. è°ƒæŸ¥æ³„éœ²åŸå› 
4. åŠ å¼ºç³»ç»Ÿå®‰å…¨

### Q4: ä¸ºä»€ä¹ˆåŒä¸€å¯†ç æ¯æ¬¡åŠ å¯†ç»“æœä¸åŒï¼Ÿ
**A**: bcrypt ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªå¯†ç ç”Ÿæˆå”¯ä¸€çš„ saltï¼ˆç›å€¼ï¼‰ï¼Œè¿™æ˜¯å®‰å…¨ç‰¹æ€§ï¼Œå¯ä»¥é˜²æ­¢å½©è™¹è¡¨æ”»å‡»ã€‚

### Q5: å¯ä»¥ä»å“ˆå¸Œè¿˜åŸå¯†ç å—ï¼Ÿ
**A**: âŒ **ä¸å¯ä»¥ï¼** bcrypt æ˜¯å•å‘å“ˆå¸Œå‡½æ•°ï¼Œç†è®ºä¸Šæ— æ³•è¿˜åŸã€‚å”¯ä¸€æ–¹æ³•æ˜¯æš´åŠ›å°è¯•æ‰€æœ‰å¯èƒ½çš„å¯†ç ç»„åˆã€‚

### Q6: Cost Factor 10 å¤Ÿå®‰å…¨å—ï¼Ÿ
**A**: âœ… **è¶³å¤Ÿï¼** å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œcost factor 10 å·²ç»å¾ˆå®‰å…¨äº†ã€‚å¦‚æœéœ€è¦æ›´é«˜å®‰å…¨æ€§ï¼Œå¯ä»¥è®¾ç½®ä¸º 12ã€‚

---

## ğŸ” å®æˆ˜æ¼”ç¤º

### æŸ¥çœ‹æ‚¨çš„å¯†ç çŠ¶æ€

```bash
sqlite3 -column -header database/autoanki.db << 'EOF'
SELECT 
    id,
    username,
    email,
    substr(password, 1, 10) || '...' as 'å¯†ç å“ˆå¸Œï¼ˆéƒ¨åˆ†ï¼‰',
    length(password) as 'å“ˆå¸Œé•¿åº¦',
    CASE 
        WHEN password LIKE '$2a$10$%' THEN 'âœ“ bcrypt åŠ å¯†'
        ELSE 'å¼‚å¸¸'
    END as 'å®‰å…¨çŠ¶æ€',
    datetime(created_at, 'localtime') as 'æ³¨å†Œæ—¶é—´'
FROM users;
EOF
```

---

## ğŸ“š ç›¸å…³æŠ€æœ¯æ–‡æ¡£

- [bcrypt å®˜æ–¹æ–‡æ¡£](https://github.com/kelektiv/node.bcrypt.js)
- [OWASP å¯†ç å­˜å‚¨æŒ‡å—](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)
- [bcrypt ç®—æ³•è¯¦è§£](https://en.wikipedia.org/wiki/Bcrypt)

---

## âœ… æ€»ç»“

### æ‚¨çš„åº”ç”¨å¯†ç å®‰å…¨æ€§

| é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|-----|------|------|
| **åŠ å¯†ç®—æ³•** | âœ… å®‰å…¨ | bcryptï¼ˆè¡Œä¸šæ ‡å‡†ï¼‰ |
| **å¯†ç å­˜å‚¨** | âœ… å®‰å…¨ | å•å‘å“ˆå¸Œï¼Œä¸å¯é€† |
| **é˜²æš´åŠ›ç ´è§£** | âœ… å®‰å…¨ | Cost Factor 10 |
| **é˜²å½©è™¹è¡¨** | âœ… å®‰å…¨ | è‡ªåŠ¨åŠ ç› |
| **æ•°æ®åº“æ³„éœ²ä¿æŠ¤** | âœ… å®‰å…¨ | å¯†ç æ— æ³•è¿˜åŸ |

### å…³é”®ç‚¹

1. âœ… **ä¸å­˜å‚¨æ˜æ–‡å¯†ç **
2. âœ… **ä½¿ç”¨ bcrypt å•å‘åŠ å¯†**
3. âœ… **æ¯ä¸ªå¯†ç éƒ½æœ‰å”¯ä¸€çš„ç›å€¼**
4. âœ… **ç®¡ç†å‘˜ä¹Ÿæ— æ³•æŸ¥çœ‹åŸå§‹å¯†ç **
5. âœ… **ç¬¦åˆå®‰å…¨æœ€ä½³å®è·µ**

---

**æ‚¨çš„å¯†ç å¾ˆå®‰å…¨ï¼** ğŸ”’


