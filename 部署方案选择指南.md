# 🎯 AutoAnki 部署方案选择指南

根据你的服务器配置，选择最合适的部署方案。

---

## 📊 快速决策表

| 服务器配置 | 推荐方案 | 文档 | 预期性能 |
|-----------|---------|------|----------|
| **1核1G** | 轻量级部署 | [LIGHTWEIGHT_DEPLOY.md](LIGHTWEIGHT_DEPLOY.md) | 10-20人在线 |
| **2核2G** | PM2部署 | [QUICK_DEPLOY.md](QUICK_DEPLOY.md) | 30-50人在线 |
| **2核4G+** | Docker部署 | [DEPLOYMENT_GUIDE.md](DEPLOYMENT_GUIDE.md) | 100+人在线 |

---

## 🪶 方案一：轻量级部署（1核1G）

### 适用场景
- ✅ 服务器只有 1核1G
- ✅ 个人使用或小团队（10-20人）
- ✅ 预算有限（月费约¥50-100）
- ✅ 追求最低资源占用

### 特点
- 内存占用：**100-200MB**
- 不使用Docker（避免额外开销）
- 必须配置2GB Swap
- 定时重启清理内存

### 快速开始
```bash
cd ~/newAutoAnki
./lightweight-manager.sh start
```

### 完整文档
👉 **[查看轻量级部署指南](LIGHTWEIGHT_DEPLOY.md)**

---

## ⚡ 方案二：标准部署（2核2G+）

### 适用场景
- ✅ 服务器有 2核2G 或更高配置
- ✅ 中小型团队使用（30-50人）
- ✅ 需要稳定可靠的服务
- ✅ 希望快速部署和管理

### 特点
- 内存占用：**300-500MB**
- 使用PM2进程管理
- 自动重启和监控
- 完善的日志管理

### 快速开始
```bash
cd ~/newAutoAnki
pm2 start ecosystem.config.js
```

### 完整文档
👉 **[查看快速部署指南](QUICK_DEPLOY.md)**

---

## 🐳 方案三：Docker部署（2核4G+）

### 适用场景
- ✅ 服务器有 2核4G 或更高配置
- ✅ 企业级应用或大型团队
- ✅ 需要环境隔离和容器化
- ✅ 便于扩展和迁移

### 特点
- 内存占用：**400-600MB**
- 完全环境隔离
- 一键启动和部署
- 易于扩展和备份

### 快速开始
```bash
cd ~/newAutoAnki
docker-compose up -d
```

### 完整文档
👉 **[查看完整部署指南](DEPLOYMENT_GUIDE.md)**

---

## 🔍 详细对比

### 资源占用对比

| 方案 | CPU | 内存 | 磁盘 | 网络 |
|------|-----|------|------|------|
| 轻量级 | 5-15% | 100-200MB | 最小 | 低 |
| PM2 | 10-20% | 300-500MB | 中等 | 中 |
| Docker | 15-30% | 400-600MB | 较大 | 中高 |

### 功能对比

| 功能 | 轻量级 | PM2 | Docker |
|------|--------|-----|--------|
| 进程管理 | 手动 | ✅ 自动 | ✅ 自动 |
| 日志管理 | 基础 | ✅ 完善 | ✅ 完善 |
| 自动重启 | 定时 | ✅ 崩溃重启 | ✅ 崩溃重启 |
| 健康检查 | 手动 | ✅ 支持 | ✅ 内置 |
| 环境隔离 | ❌ | ❌ | ✅ 完全隔离 |
| 扩展性 | 一般 | 良好 | ✅ 优秀 |
| 部署难度 | 简单 | 中等 | 中等 |

### 维护成本对比

| 方案 | 部署时间 | 维护难度 | 学习成本 |
|------|---------|---------|---------|
| 轻量级 | 5分钟 | ⭐ 低 | ⭐ 低 |
| PM2 | 10分钟 | ⭐⭐ 中 | ⭐⭐ 中 |
| Docker | 15分钟 | ⭐⭐⭐ 中高 | ⭐⭐⭐ 中高 |

---

## 💰 成本分析

### 云服务器价格参考（月付）

| 配置 | 阿里云 | 腾讯云 | 推荐方案 |
|------|--------|--------|---------|
| 1核1G | ¥50-80 | ¥45-75 | 轻量级部署 |
| 2核2G | ¥120-180 | ¥110-170 | PM2部署 |
| 2核4G | ¥200-280 | ¥190-270 | Docker部署 |

**性价比建议**：
- 个人使用：1核1G + 轻量级部署（最经济）
- 小团队：2核2G + PM2部署（平衡性价比）
- 企业级：2核4G+ + Docker部署（稳定可靠）

---

## 🎯 决策流程图

```
开始
  │
  ▼
你的服务器是1核1G吗？
  │
  ├─ 是 ──→ 【轻量级部署】
  │         - 配置Swap
  │         - 直接运行
  │         - 内存限制400MB
  │
  └─ 否 ──→ 服务器≥2核4G吗？
            │
            ├─ 是 ──→ 【Docker部署】
            │         - 环境隔离
            │         - 一键部署
            │         - 易于扩展
            │
            └─ 否 ──→ 【PM2部署】
                      - 进程管理
                      - 自动重启
                      - 日志完善
```

---

## 📋 实际场景推荐

### 场景1：个人学习使用
- **用户数**：1-5人
- **配置**：1核1G
- **方案**：轻量级部署
- **成本**：¥50-80/月

### 场景2：小型学习团队
- **用户数**：10-30人
- **配置**：2核2G
- **方案**：PM2部署
- **成本**：¥120-180/月

### 场景3：教育机构/企业
- **用户数**：50-200人
- **配置**：2核4G或更高
- **方案**：Docker部署
- **成本**：¥200-400/月

### 场景4：大型在线服务
- **用户数**：500+人
- **配置**：4核8G + 负载均衡
- **方案**：Docker集群
- **成本**：¥800-1500/月

---

## ⚡ 快速命令对比

### 轻量级部署
```bash
# 启动
./lightweight-manager.sh start

# 状态
./lightweight-manager.sh status

# 日志
./lightweight-manager.sh logs -f

# 重启
./lightweight-manager.sh restart
```

### PM2部署
```bash
# 启动
pm2 start ecosystem.config.js

# 状态
pm2 status

# 日志
pm2 logs autoanki

# 重启
pm2 restart autoanki
```

### Docker部署
```bash
# 启动
docker-compose up -d

# 状态
docker-compose ps

# 日志
docker-compose logs -f

# 重启
docker-compose restart
```

---

## 🔧 性能优化建议

### 1核1G服务器（轻量级）

必做优化：
1. ✅ 配置2GB Swap（必须！）
2. ✅ 限制Node.js内存400MB
3. ✅ 每天定时重启
4. ✅ 关闭不必要的服务

可选优化：
- 配置Nginx缓存
- 使用CDN加速
- 启用Gzip压缩

### 2核2G+服务器（标准）

推荐优化：
1. ✅ 使用PM2集群模式
2. ✅ 配置Nginx反向代理
3. ✅ 启用日志轮转
4. ✅ 定期数据库优化

可选优化：
- 配置SSL证书
- 使用Redis缓存
- 配置监控告警

### 2核4G+服务器（Docker）

推荐优化：
1. ✅ Docker资源限制
2. ✅ Nginx + SSL
3. ✅ 完善的监控
4. ✅ 自动化备份

可选优化：
- 使用Docker Swarm集群
- 配置负载均衡
- 使用专业数据库

---

## 🆘 迁移指南

### 从轻量级迁移到PM2

```bash
# 1. 停止轻量级服务
./lightweight-manager.sh stop

# 2. 安装PM2
sudo npm install -g pm2

# 3. 启动PM2
pm2 start ecosystem.config.js
pm2 save
```

### 从PM2迁移到Docker

```bash
# 1. 备份数据库
./backup.sh

# 2. 停止PM2
pm2 stop autoanki
pm2 delete autoanki

# 3. 启动Docker
docker-compose up -d

# 4. 验证服务
docker-compose ps
```

---

## 📚 相关文档

| 文档 | 内容 | 适用对象 |
|------|------|----------|
| [LIGHTWEIGHT_DEPLOY.md](LIGHTWEIGHT_DEPLOY.md) | 轻量级部署详解 | 1核1G用户 |
| [QUICK_DEPLOY.md](QUICK_DEPLOY.md) | 快速部署指南 | 2核2G+用户 |
| [DEPLOYMENT_GUIDE.md](DEPLOYMENT_GUIDE.md) | 完整部署指南 | 所有用户 |
| [DEPLOYMENT_CHECKLIST.md](DEPLOYMENT_CHECKLIST.md) | 部署检查清单 | 所有用户 |

---

## 💡 常见问题

### Q1: 我的服务器是1核1G，能正常运行吗？

**A**: 可以！使用轻量级部署方案，配合Swap，完全可以支持10-20人同时使用。关键是：
1. 必须配置2GB Swap
2. 限制Node.js内存为400MB
3. 定时重启清理内存

### Q2: Docker比PM2好在哪里？

**A**: 
- Docker优势：环境隔离、易于迁移、方便扩展
- PM2优势：资源占用低、灵活性高、学习成本低

选择建议：
- 资源紧张 → PM2
- 需要容器化 → Docker

### Q3: 可以先用轻量级，以后升级吗？

**A**: 完全可以！只需：
1. 备份数据库
2. 停止当前服务
3. 按新方案启动
数据库和配置文件通用，无需修改。

### Q4: 哪个方案最省钱？

**A**: 
- 最省钱：轻量级（1核1G，¥50-80/月）
- 性价比：PM2（2核2G，¥120-180/月）
- 长期发展：Docker（2核4G，¥200-280/月）

个人或小团队推荐轻量级方案。

### Q5: 我应该选哪个方案？

**A**: 根据这个简单规则：
```
if (预算 < 100元/月) {
    选择 轻量级部署
} else if (用户数 < 50人) {
    选择 PM2部署
} else {
    选择 Docker部署
}
```

---

## 🎊 总结

| 如果你... | 那么选择... | 原因 |
|---------|-----------|------|
| 服务器是1核1G | 轻量级部署 | 资源最优，成本最低 |
| 想要省心省力 | PM2部署 | 自动管理，稳定可靠 |
| 需要企业级方案 | Docker部署 | 隔离环境，易于扩展 |
| 还在纠结 | 从轻量级开始 | 随时可升级 |

---

**不要纠结，立即开始！** 🚀

选择适合你的方案，查看对应文档，5-15分钟即可完成部署。

---

*最后更新：2025-10-17*


