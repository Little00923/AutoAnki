# 填空卡测试指南

## ✅ 已修复的问题

### 问题描述
- AI生成的填空卡在Anki中直接显示 `{{c1::答案}}`，没有隐藏
- 占位符没有被正确处理

### 修复内容
1. **恢复完整的提示词** - 包含所有4种卡片类型的详细说明
2. **明确填空卡格式** - front用{{c1::}}，back用纯文本
3. **优化生成规则** - 特别强调填空卡的生成要求
4. **导出逻辑** - 将 `{{c1::答案}}` 转换为 `[...]`

## 🧪 测试步骤

### 步骤1：重启服务器

```bash
# 按 Ctrl+C 停止服务器
npm start  # 重新启动
```

### 步骤2：生成测试卡片

使用以下测试材料：

```
现在已有大量低成本微调的方法，例如LoRA和QLoRA。
LoRA（Low-Rank Adaptation）通过在预训练模型中添加低秩矩阵来实现高效微调。
QLoRA在LoRA的基础上使用量化技术，进一步降低显存需求。
```

### 步骤3：检查生成的卡片

AI应该生成类似这样的填空卡：

**正确格式示例：**
```json
{
  "type": "cloze",
  "front": "现在已有大量低成本微调的方法，例如___和___。",
  "back": "LoRA、QLoRA",
  "tags": ["机器学习", "微调"]
}
```

**注意：**
- ✅ front 使用 `___`（三个下划线）作为占位符
- ✅ back 仅包含被挖空的答案
- ✅ 多个答案用顿号或逗号分隔
- ❌ front 中不能包含答案

### 步骤4：导出到Anki

1. 点击"导出"按钮
2. 下载 `.apkg` 文件
3. 在Anki中导入

### 步骤5：在Anki中验证

**填空卡应该显示为：**

**正面（问题）：**
```
现在已有大量低成本微调的方法，例如___和___。
```

**背面（答案）：**
```
LoRA、QLoRA
```

## 📊 预期结果对比

| 项目 | 错误格式 ❌ | 正确格式 ✅ |
|------|------------|------------|
| AI生成front | `...例如{{c1::LoRA}}...`<br/>（包含答案） | `...例如___和___`<br/>（只有占位符） |
| AI生成back | 完整句子 | `LoRA、QLoRA`<br/>（仅答案） |
| Anki显示正面 | `___和___` | `___和___` |
| Anki显示背面 | 完整句子 | `LoRA、QLoRA` |

## 🔍 故障排查

### 问题1：AI在front中包含了答案

**原因：** AI模型可能需要多次尝试才能理解新的提示词

**解决：**
1. 重新生成卡片（点击"返回重新制卡"）
2. 尝试不同的输入材料
3. 手动编辑：在预览页面将front中的答案替换为 `___`

### 问题2：back字段是完整句子而不是答案

**原因：** AI理解有偏差

**解决：**
1. 在预览页面点击back字段的"编辑"
2. 删除多余内容，只保留答案
3. 多个答案用顿号分隔
4. 点击"保存"

### 问题3：演示模式正常，真实API生成有问题

**解决方案：** 手动编辑生成的卡片
1. 检查front：确保只有 `___` 占位符，没有答案
2. 检查back：确保只有答案，没有完整句子
3. 修改后导出

## 🎯 完整的正确示例

### 示例1：单个填空
```json
{
  "type": "cloze",
  "front": "LoRA的全称是___",
  "back": "Low-Rank Adaptation"
}
```

**Anki显示：**
- 正面：`LoRA的全称是___`
- 背面：`Low-Rank Adaptation`

### 示例2：多个填空
```json
{
  "type": "cloze",
  "front": "___通过添加___来实现微调",
  "back": "LoRA、低秩矩阵"
}
```

**Anki显示：**
- 正面：`___通过添加___来实现微调`
- 背面：`LoRA、低秩矩阵`

### 示例3：复杂句子
```json
{
  "type": "cloze",
  "front": "光合作用中，绿色植物利用___，将___和___转化为有机物",
  "back": "光能、二氧化碳、水"
}
```

**Anki显示：**
- 正面：`光合作用中，绿色植物利用___，将___和___转化为有机物`
- 背面：`光能、二氧化碳、水`

## 💡 使用建议

1. **检查填空卡格式**
   - front：只有 `___` 占位符，不含答案
   - back：只有答案，不含句子
   
2. **手动编辑** - 在预览页面可以随时编辑卡片
   - 如果AI生成格式不对，直接编辑修改
   
3. **多个答案的分隔**
   - 推荐使用顿号：`答案1、答案2、答案3`
   - 也可以用逗号：`答案1, 答案2, 答案3`
   
4. **测试导出** - 每次修改后都先用小批量测试

## 📞 需要帮助？

如果问题仍然存在：
1. 检查 `server.js` 第61-95行的提示词
2. 检查 `server.js` 第197-201行的导出逻辑
3. 提供具体的AI生成结果和Anki显示效果

---

**修复完成时间**: 2025-10-15  
**版本**: v1.1.0

