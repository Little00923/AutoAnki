# ğŸ“‹ AutoAnki æ•°æ®åº“æ“ä½œé€ŸæŸ¥è¡¨

## ğŸ¯ å¿«é€Ÿç­”æ¡ˆ

### â“ æ•°æ®åº“è´¦å·å¯†ç æ˜¯ä»€ä¹ˆï¼Ÿ
**ç­”**ï¼šSQLite ä¸éœ€è¦è´¦å·å¯†ç ï¼å®ƒæ˜¯æ–‡ä»¶å‹æ•°æ®åº“ï¼Œç›´æ¥è®¿é—®æ–‡ä»¶å³å¯ã€‚

### ğŸ“ æ•°æ®åº“åœ¨å“ªé‡Œï¼Ÿ
```bash
database/autoanki.db
```

---

## ğŸš€ æœ€å¸¸ç”¨å‘½ä»¤

### 1. æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
```bash
./db_manager.sh users
```

### 2. ç»™ç”¨æˆ·å……å€¼ç§¯åˆ†
```bash
# æ–¹æ³•Aï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
./db_manager.sh
# ç„¶åé€‰æ‹© 3) ç»™ç”¨æˆ·å……å€¼ç§¯åˆ†

# æ–¹æ³•Bï¼šç›´æ¥ä½¿ç”¨SQL
sqlite3 database/autoanki.db << EOF
UPDATE users SET credits = credits + 1000 WHERE username = 'L';
EOF
```

### 3. æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡
```bash
./db_manager.sh stats
```

### 4. å¤‡ä»½æ•°æ®åº“
```bash
./db_manager.sh backup
```

### 5. æŸ¥çœ‹ç³»ç»Ÿé…ç½®
```bash
./db_manager.sh config
```

---

## ğŸ’¡ å¸¸è§åœºæ™¯

### åœºæ™¯1: ç”¨æˆ·ç§¯åˆ†ä¸è¶³ï¼Œéœ€è¦å……å€¼

```bash
# ä½¿ç”¨ç®¡ç†è„šæœ¬
./db_manager.sh

# é€‰æ‹© 3) ç»™ç”¨æˆ·å……å€¼ç§¯åˆ†
# è¾“å…¥ç”¨æˆ·å: L
# è¾“å…¥å……å€¼ç§¯åˆ†: 1000
# è¾“å…¥è¯´æ˜: æ‰‹åŠ¨å……å€¼
```

### åœºæ™¯2: ä¿®æ”¹è¯•ç”¨æ¬¡æ•°

```bash
sqlite3 database/autoanki.db << EOF
-- ä¿®æ”¹æœªç™»å½•è¯•ç”¨æ¬¡æ•°ä¸º5æ¬¡
UPDATE system_config 
SET value = '5' 
WHERE key = 'free_trial_times';
EOF
```

### åœºæ™¯3: æŸ¥çœ‹ç”¨æˆ·è¯¦ç»†ä¿¡æ¯

```bash
sqlite3 -column -header database/autoanki.db << EOF
SELECT * FROM users WHERE username = 'L';
EOF
```

### åœºæ™¯4: é‡ç½®ç”¨æˆ·è¯•ç”¨é¢åº¦

```bash
sqlite3 database/autoanki.db << EOF
UPDATE users SET free_cards_used = 0 WHERE username = 'L';
EOF
```

---

## ğŸ”§ ä¸‰ç§ç»´æŠ¤æ–¹å¼å¯¹æ¯”

| æ–¹å¼ | éš¾åº¦ | é€‚ç”¨åœºæ™¯ |
|-----|------|----------|
| **1. db_manager.sh** | â­ ç®€å• | æ—¥å¸¸ç»´æŠ¤ã€å¿«é€Ÿæ“ä½œ |
| **2. SQLite CLI** | â­â­ ä¸­ç­‰ | å¤æ‚æŸ¥è¯¢ã€æ‰¹é‡æ“ä½œ |
| **3. å›¾å½¢å·¥å…·** | â­ ç®€å• | æŸ¥çœ‹æ•°æ®ã€å¯è§†åŒ–ç¼–è¾‘ |

---

## ğŸ“Š é‡è¦æ•°æ®è¡¨

### users - ç”¨æˆ·è¡¨
```sql
-- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
SELECT id, username, email, credits FROM users;

-- æŸ¥çœ‹ç‰¹å®šç”¨æˆ·
SELECT * FROM users WHERE username = 'L';
```

### credit_transactions - ç§¯åˆ†äº¤æ˜“è¡¨
```sql
-- æŸ¥çœ‹æœ€è¿‘äº¤æ˜“
SELECT 
    u.username,
    ct.type,
    ct.amount,
    ct.description,
    datetime(ct.created_at, 'localtime') as time
FROM credit_transactions ct
JOIN users u ON ct.user_id = u.id
ORDER BY ct.created_at DESC
LIMIT 10;
```

### system_config - ç³»ç»Ÿé…ç½®è¡¨
```sql
-- æŸ¥çœ‹æ‰€æœ‰é…ç½®
SELECT * FROM system_config;

-- ä¿®æ”¹é…ç½®
UPDATE system_config SET value = 'æ–°å€¼' WHERE key = 'é…ç½®é¡¹';
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ“ä½œå‰å…ˆå¤‡ä»½**
   ```bash
   ./db_manager.sh backup
   ```

2. **ä¿®æ”¹é…ç½®åå¯èƒ½éœ€è¦é‡å¯æœåŠ¡å™¨**
   ```bash
   pkill -f "node server.js"
   npm start
   ```

3. **SQLite ä¸æ”¯æŒå¤šä¸ªå†™å…¥åŒæ—¶è¿›è¡Œ**
   - å¦‚æœæ˜¾ç¤º "database is locked"ï¼Œå…ˆåœæ­¢æœåŠ¡å™¨

---

## ğŸ†˜ ç´§æ€¥é—®é¢˜å¤„ç†

### é—®é¢˜ï¼šæ•°æ®åº“é”å®š
```bash
# åœæ­¢æœåŠ¡å™¨
pkill -f "node server.js"

# é‡å¯
npm start
```

### é—®é¢˜ï¼šæ•°æ®ä¸¢å¤±
```bash
# æ¢å¤æœ€è¿‘çš„å¤‡ä»½
cp backups/æœ€æ–°å¤‡ä»½.db.gz ./
gunzip æœ€æ–°å¤‡ä»½.db.gz
cp æœ€æ–°å¤‡ä»½.db database/autoanki.db
npm start
```

---

## ğŸ“ è·å–å¸®åŠ©

- è¯¦ç»†æ–‡æ¡£ï¼š`æ•°æ®åº“ç»´æŠ¤æŒ‡å—.md`
- æµ‹è¯•æŒ‡å—ï¼š`QUICK_TEST_GUIDE.md`
- æ•°æ®åº“ç»´æŠ¤ï¼š`DATABASE_MAINTENANCE.md`

---

**å¿«é€Ÿå¯åŠ¨ç®¡ç†å·¥å…·**:
```bash
./db_manager.sh
```


